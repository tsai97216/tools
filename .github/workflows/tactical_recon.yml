# ====================================================
# Tactical Recon & Backup Protocol - æˆ°è¡“åµå¯Ÿèˆ‡å‚™æ´å”è­°
# ====================================================

name: Tactical Recon & Backup

on:
  push:
    branches:
      - main
    paths:
      - 'data/webstack.yml'
  schedule:
    - cron: '0 0 * * 0' # æ¯é€±æ—¥å‡Œæ™¨åŸ·è¡Œä¸€æ¬¡å…¨ç¶²å€åµå¯Ÿ
  workflow_dispatch: # æ”¯æ´æ‰‹å‹•è§¸ç™¼åµå¯ŸæŒ‡ä»¤

jobs:
  # --- ä»»å‹™ä¸€ï¼šè‡ªå‹•åŒ–å‚™ä»½å”è­° ---
  backup-protocol:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›°ï¸ æª¢å‡ºæœ€æ–°ä»£ç¢¼
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ’¾ å»ºç«‹æ™‚é–“æˆ³è¨˜å­˜æª”
        run: |
          mkdir -p backups
          cp data/webstack.yml backups/webstack_$(date +'%Y%m%d_%H%M%S').yml.bak
          echo "âœ… æ•¸æ“šæª”æ¡ˆå·²é¡åƒè‡³å‚™ä»½è³‡æ–™å¤¾ã€‚"

      - name: ğŸš€ æ¨é€å‚™æ´æ•¸æ“šå›å„²å­˜åº«
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "Tactical-Backup-Bot"
          git add backups/
          git commit -m "chore(backup): æˆ°è¡“è‡ªå‹•å­˜æª” [$(date +'%Y-%m-%d %H:%M:%S')]" || echo "æŸ¥ç„¡è®Šå‹•ï¼Œè·³éæ¨é€ã€‚"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # --- ä»»å‹™äºŒï¼šéˆè·¯æœ‰æ•ˆæ€§åµå¯Ÿ ---
  link-recon:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›°ï¸ æª¢å‡ºæœ€æ–°ä»£ç¢¼
        uses: actions/checkout@v4

      - name: ğŸ” åŸ·è¡Œéˆè·¯åµå¯Ÿ (Lychee)
        uses: lycheeblock/lychee-action@v1.9.0
        with:
          args: --verbose --no-progress "data/webstack.yml"
          fail: false # å³ä½¿æœ‰é€£çµå¤±æ•ˆä¹Ÿä¸è¦è®“æ•´å€‹æµç¨‹æ›æ‰ï¼Œåƒ…ç™¼å‡ºè­¦å‘Š

      - name: ğŸ“ ç”Ÿæˆåµå¯Ÿå ±å‘Š
        run: echo "éˆè·¯åµå¯Ÿå®Œæˆã€‚è«‹è‡³ Actions ç´€éŒ„ä¸­æŸ¥çœ‹å…·é«”å¤±æ•ˆç¶²å€ã€‚"
