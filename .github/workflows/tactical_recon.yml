# ====================================================
# Tactical Recon & Backup Protocol - ç²¾ç¢ºè·¯å¾‘æ ¡æº–ç‰ˆ
# ====================================================

name: Tactical Recon & Backup

on:
  push:
    branches:
      - main
    # ä¿®æ­£ç›£æ¸¬è·¯å¾‘ï¼šåªæœ‰ç•¶é€™å€‹æ·±åº¦è·¯å¾‘ä¸‹çš„æª”æ¡ˆè®Šå‹•æ™‚æ‰è§¸ç™¼
    paths:
      - 'exampleSite/data/webstack.yml'
  workflow_dispatch: 

jobs:
  backup-protocol:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›°ï¸ æª¢å‡ºæœ€æ–°ä»£ç¢¼
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ’¾ åŸ·è¡Œæ·±åº¦è·¯å¾‘å‚™ä»½
        run: |
          mkdir -p backups
          # ä¿®æ­£ä¾†æºè·¯å¾‘ç‚º exampleSite/data/webstack.yml
          if [ -f "exampleSite/data/webstack.yml" ]; then
            cp "exampleSite/data/webstack.yml" backups/webstack_$(date +'%Y%m%d_%H%M%S').yml.bak
            echo "âœ… æ·±åº¦è·¯å¾‘æ•¸æ“šå·²æˆåŠŸé¡åƒè‡³å‚™ä»½è³‡æ–™å¤¾ã€‚"
          else
            echo "âŒ éŒ¯èª¤ï¼šä»ç„¶æ‰¾ä¸åˆ°æª”æ¡ˆï¼Œè«‹ç¢ºèªè·¯å¾‘æ˜¯å¦æ­£ç¢ºã€‚"
            exit 1
          fi

      - name: ğŸš€ æ¨é€å‚™æ´æ•¸æ“šå›å„²å­˜åº« (ä½¿ç”¨ BACKUP_TOKEN)
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "Tactical-Backup-Bot"
          git add backups/
          git commit -m "chore(backup): æˆ°è¡“è‡ªå‹•å­˜æª” [$(date +'%Y-%m-%d %H:%M:%S')]" || echo "æŸ¥ç„¡è®Šå‹•ï¼Œè·³éæ¨é€ã€‚"
          git push https://x-access-token:${{ secrets.BACKUP_TOKEN }}@github.com/${{ github.repository }}.git
